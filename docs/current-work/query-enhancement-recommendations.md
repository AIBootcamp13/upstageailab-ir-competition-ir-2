키워드가 명확하지 않은 요청들의 검색 효율을 높이는 가장 효과적인 기법은 **질의 재작성(Query Rewriting)**을 통해 사용자의 숨은 의도를 명확한 검색어로 바꾸는 것입니다.

제공해주신 데이터의 요청들은 RAG 시스템이 실세계에서 마주하는 다양한 문제들을 잘 보여줍니다.

---
### ## 쿼리 분석: 문제점과 유형

요청들은 다음과 같은 문제 유형으로 나눌 수 있습니다.

####  🤔 1. 개념적/추상적 질문 (Conceptual Queries)
단순 키워드 매칭만으로는 찾기 어려운, 개념 간의 관계나 차이, 역할에 대한 질문입니다.
- `플랑크톤의 역할에 대해 알려줘.`
- `기생과 공생의 차이에 대해 알려줘.`
- `다람쥐가 열매를 땅에 묻는 행동이 나무에 미치는 영향은?`

#### 👋 2. 대화형/비정보성 질문 (Conversational / Chit-Chat)
정보 검색이 목적이 아닌, AI 어시스턴트와의 상호작용이나 대화입니다. 이런 요청에 대해 과학 문서를 검색하는 것은 부적절합니다.
- `너 잘하는게 뭐야?`
- `너 정말 똑똑하다!`
- `우울한데 신나는 얘기 좀 해줄래?`
- `이제 그만 얘기하자.`

#### 🔄 3. 다중 대화 질문 (Multi-turn Queries)
이전 대화의 맥락을 이해해야만 정확한 의도를 파악할 수 있는 질문입니다. 마지막 발화만으로는 정보가 부족합니다.
- `python 공부중인데...` -> `숫자 계산을 위한 operator 우선순위에 대해 알려줘.` (맥락: 파이썬의 연산자 우선순위)
- `...가장 많은 물은 바닷물이잖아?` -> `바닷물 말고 담수가 가장 많이 있는 곳이 어디야?` (맥락: 바닷물을 제외한 담수 최다 보유 지역)

#### 🗺️ 4. 모호하거나 범위가 넓은 질문 (Ambiguous Queries)
사용된 단어가 너무 일반적이어서 어떤 전문 분야의 문서를 찾아야 할지 명확하지 않은 질문입니다.
- `지구에서 새로운 땅이 생겨나는 메커니즘은?` ('새로운 땅' -> 판 구조론, 해저 확장, 화산 활동?)
- `더러워진 엔진오일을 잘 처리하는 방법에 대해 알려줘.` (지식 베이스의 범위를 벗어나는 질문, Out-of-Domain)

---
### ## 검색 효율성 극대화를 위한 3가지 핵심 기법

위 문제들을 해결하고 검색 효율을 높이기 위해 다음 세 가지 기법을 적용할 수 있습니다.

#### 1. 🧠 질의 재작성 (Query Rewriting)
이것이 가장 중요하고 기본적인 해결책입니다. [cite_start]사용자의 원래 질문을 LLM을 사용해 검색에 최적화된 형태로 변환하는 것입니다. [cite: 811]

- **역할**:
  - **키워드 확장**: 모호한 질문에 구체적인 전문 용어를 추가합니다.
  - **맥락 요약**: 여러 번의 대화를 하나의 완전한 독립형 질문으로 압축합니다.
  - **의도 명확화**: 숨겨진 의도를 명시적인 질문 형태로 바꿉니다.

| Before (사용자 원본) | After (재작성된 검색어) | 해결하는 문제 |
| :--- | :--- | :--- |
| `새로운 땅이 생겨나는 메커니즘은?` | `판 구조론과 화산 활동으로 인해 새로운 지각이 형성되는 과정` | 모호한 질문 |
| User: `바닷물 말고 담수가 가장 많이 있는 곳이 어디야?` | `지구상에서 바닷물을 제외하고 담수가 가장 많이 분포하는 곳은 빙하와 만년설이다.` | 다중 대화 |
| `다람쥐가 열매를 묻는 행동의 영향은?` | `다람쥐의 저장 행동이 씨앗 분산을 통해 숲 생태계에 미치는 긍정적 영향` | 개념적 질문 |

#### 2. 🚦 질의 분류 (Query Classification)
본격적인 검색을 시작하기 전에, LLM을 이용해 사용자의 질문 의도를 먼저 분류하는 단계입니다.

- **분류 종류**:
  - **정보 검색형 (Information-seeking)**: 과학적 사실, 설명 등을 요구하는 질문.
  - **대화형 (Conversational)**: 인사, 감정 표현, AI 자체에 대한 질문 등.

- **작동 방식**:
  - 질문이 **대화형**으로 분류되면, `scientific_search` 도구를 호출하지 않고 RAG 파이프라인을 건너뛴 후, 챗봇으로서 간단한 대화로 응답합니다.
  - 이렇게 하면 불필요한 검색을 막아 비용과 시간을 절약하고, "너는 누구니?" 같은 질문에 과학 문서를 찾는 어색한 상황을 피할 수 있습니다.

#### 3. 📝 가상 문서 생성 (HyDE: Hypothetical Document Embeddings)
개념적이거나 추상적인 질문에 특히 효과적인 고급 기법입니다.

- **작동 방식**:
  1.  사용자의 질문("기생과 공생의 차이")을 LLM에 던져, 그 질문에 대한 **가상의 완벽한 답변**을 먼저 생성합니다. (예: "기생은 한 생물이 다른 생물에게 해를 끼치며 이득을 얻는 관계이며, 공생은...")
  2.  이 짧은 원본 질문 대신, 훨씬 풍부한 정보를 담고 있는 **가상 답변의 임베딩(embedding)**을 사용해 실제 문서들과 비교하여 유사한 문서를 찾습니다.

- **장점**: 짧고 모호한 질문보다, 상세하게 생성된 가상 답변이 시맨틱 공간에서 훨씬 더 정확한 위치를 차지하므로, 키워드가 직접 일치하지 않더라도 의미적으로 가장 유사한 문서를 효과적으로 찾아낼 수 있습니다.