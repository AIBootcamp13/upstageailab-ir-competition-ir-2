# **π€ ν”„λ΅μ νΈ μ‚¬μ© κ°€μ΄λ“**

μ΄ λ¬Έμ„λ” RAG(Retrieval-Augmented Generation) ν”„λ΅μ νΈμ μ£Όμ” κΈ°λ¥μ„ μ‚¬μ©ν•κ³ ### **3.2. κ²€μƒ‰ μ„±λ¥ κ²€μ¦ λ° ν•μ΄νΌνλΌλ―Έν„° νλ‹**

validate_retrieval.py μ¤ν¬λ¦½νΈλ” validation.jsonl νμΌμ„ μ‚¬μ©ν•μ—¬ ν„μ¬ λ¨λΈμ κ²€μƒ‰ μ„±λ¥μ„ **MAP(Mean Average Precision)** μ μλ΅ μΈ΅μ •ν•©λ‹λ‹¤. μ΄ μ¤ν¬λ¦½νΈλ¥Ό μ‚¬μ©ν•μ—¬ λ‹¤μ–‘ν• ν•μ΄νΌνλΌλ―Έν„°λ¥Ό ν…μ¤νΈν•κ³  μµμ μ μ΅°ν•©μ„ μ°Ύμ„ μ μμµλ‹λ‹¤.

**μƒν” μ μ ν•:** λΉ λ¥Έ ν…μ¤νΈλ¥Ό μ„ν•΄ μƒν” μλ¥Ό μ ν•ν•  μ μμµλ‹λ‹¤. κΈ°λ³Έμ μΌλ΅ μ „μ²΄ κ²€μ¦ λ°μ΄ν„°λ¥Ό μ‚¬μ©ν•μ§€λ§, `params.retrieval.max_samples` νλΌλ―Έν„°λ΅ μ ν•ν•  μ μμµλ‹λ‹¤ (0μ΄λ©΄ μ „μ²΄ μ‚¬μ©).

μ‚¬μ© μμ‹: alpha κ°’ νλ‹
alphaλ” BM25(ν‚¤μ›λ“ κ²€μƒ‰)μ™€ μ‹λ§¨ν‹± κ²€μƒ‰(μλ―Έ κΈ°λ° κ²€μƒ‰)μ κ°€μ¤‘μΉλ¥Ό μ΅°μ ν•λ” μ¤‘μ”ν• νλΌλ―Έν„°μ…λ‹λ‹¤.
# κΈ°μ¤€ μ„±λ¥ μΈ΅μ • (alpha κΈ°λ³Έκ°’ μ‚¬μ©)
PYTHONPATH=src poetry run python scripts/validate_retrieval.py

# μ‹λ§¨ν‹± κ²€μƒ‰μ— λ” ν° κ°€μ¤‘μΉλ¥Ό λ¶€μ—¬ν•μ—¬ ν…μ¤νΈ
PYTHONPATH=src poetry run python scripts/validate_retrieval.py params.retrieval.alpha=0.3

# ν‚¤μ›λ“ κ²€μƒ‰μ— λ” ν° κ°€μ¤‘μΉλ¥Ό λ¶€μ—¬ν•μ—¬ ν…μ¤νΈ
PYTHONPATH=src poetry run python scripts/validate_retrieval.py params.retrieval.alpha=0.7

# 10κ° μƒν”λ΅ λΉ λ¥Έ ν…μ¤νΈ
PYTHONPATH=src poetry run python scripts/validate_retrieval.py params.retrieval.max_samples=10

κ°κ°μ MAP μ μλ¥Ό λΉ„κµν•μ—¬ κ°€μ¥ λ†’μ€ μ μλ¥Ό λ‚΄λ” alpha κ°’μ„ μ°Ύμ€ ν›„, κ·Έ κ°’μ„ μµμΆ… λ¨λΈμ— μ μ©ν•  μ μμµλ‹λ‹¤.μ„ν• μ μ¶λ¬Όμ„ μƒμ„±ν•λ” μ „μ²΄ μ›ν¬ν”λ΅μ°λ¥Ό μ•λ‚΄ν•©λ‹λ‹¤.

## **λ©μ°¨**

1. [μ΄κΈ° μ„¤μ •](#1-μ΄κΈ°-μ„¤μ •)
2. [ν•µμ‹¬ μ›ν¬ν”λ΅μ°](#2-ν•µμ‹¬-μ›ν¬ν”λ΅μ°)
3. [λ¨λΈ μ„±λ¥ νλ‹ λ° κ²€μ¦](#3-λ¨λΈ-μ„±λ¥-νλ‹-λ°-κ²€μ¦)
4. [κ³ κΈ‰ μ‹¤ν— κ°€μ΄λ“](#4-κ³ κΈ‰-μ‹¤ν—-κ°€μ΄λ“)

## **1. μ΄κΈ° μ„¤μ •**

ν”„λ΅μ νΈλ¥Ό μ‹¤ν–‰ν•κΈ° μ„ν•΄ ν•„μ”ν• μ΄κΈ° μ„¤μ • λ‹¨κ³„μ…λ‹λ‹¤.

### **1.1. μμ΅΄μ„± μ„¤μΉ**

Poetryλ¥Ό μ‚¬μ©ν•μ—¬ ν•„μ”ν• λ¨λ“  λΌμ΄λΈλ¬λ¦¬λ¥Ό μ„¤μΉν•©λ‹λ‹¤.

poetry install

### **1.2. ν™κ²½ λ³€μ μ„¤μ •**

ν”„λ΅μ νΈ λ£¨νΈ λ””λ ‰ν† λ¦¬μ— μλ” .env.example νμΌμ„ λ³µμ‚¬ν•μ—¬ .env νμΌμ„ μƒμ„±ν•©λ‹λ‹¤. κ·Έ ν›„, νμΌ λ‚΄μ OPENAI_API_KEY κ°’μ„ μμ‹ μ ν‚¤λ΅ μ±„μ›λ„£μµλ‹λ‹¤.

cp .env.example .env
# nano .env λλ” λ‹¤λ¥Έ νΈμ§‘κΈ°λ¥Ό μ‚¬μ©ν•μ—¬ API ν‚¤λ¥Ό μ…λ ¥ν•μ„Έμ”.

### **1.3. λ΅μ»¬ μΈν”„λΌ μ‹¤ν–‰**

Elasticsearchμ™€ Redisλ¥Ό λ΅μ»¬ ν™κ²½μ—μ„ μ‹¤ν–‰ν•©λ‹λ‹¤. μ΄ μ¤ν¬λ¦½νΈλ” ν•„μ”ν• κ²½μ° μ„λΉ„μ¤λ¥Ό μλ™μΌλ΅ λ‹¤μ΄λ΅λ“ν•κ³  μ„¤μ •ν•©λ‹λ‹¤.

./scripts/run-local.sh start

**μ°Έκ³ :** status λ…λ Ήμ–΄λ΅ μ„λΉ„μ¤ μƒνƒλ¥Ό ν™•μΈν•  μ μμµλ‹λ‹¤. (./scripts/run-local.sh status)

### **1.4. λ°μ΄ν„° μƒ‰μΈ (Indexing)**

λ€νμ—μ„ μ κ³µλ documents.jsonl νμΌμ„ Elasticsearchμ— μƒ‰μΈν•©λ‹λ‹¤. μ΄ μ‘μ—…μ€ κ²€μƒ‰μ„ μ„ν•΄ ν•„μμ μ΄λ©°, ν• λ²λ§ μν–‰ν•λ©΄ λ©λ‹λ‹¤.

PYTHONPATH=src poetry run python scripts/reindex.py data/documents.jsonl --index test

## **2. ν•µμ‹¬ μ›ν¬ν”λ΅μ°**

ν”„λ΅μ νΈμ μ£Όμ” κΈ°λ¥μ„ μ‹¤ν–‰ν•λ” λ°©λ²•μ…λ‹λ‹¤.

### **2.1. λ‹¨μΌ μ§λ¬ΈμΌλ΅ RAG νμ΄ν”„λΌμΈ ν…μ¤νΈ**

run_rag.py μ¤ν¬λ¦½νΈλ¥Ό μ‚¬μ©ν•μ—¬ λ‹¨μΌ μ§λ¬Έμ— λ€ν• μ „μ²΄ RAG νμ΄ν”„λΌμΈμ λ™μ‘μ„ ν…μ¤νΈν•  μ μμµλ‹λ‹¤. μ΄ μ¤ν¬λ¦½νΈλ” LLMμ λ„κµ¬ νΈμ¶, λ¬Έμ„ κ²€μƒ‰, μµμΆ… λ‹µλ³€ μƒμ„± κ³Όμ •μ„ λ¨λ‘ ν¬ν•¨ν•©λ‹λ‹¤.

# OpenAI λ¨λΈ μ‚¬μ© (κΈ°λ³Έκ°’)
PYTHONPATH=src poetry run python scripts/run_rag.py "κ΄‘ν•©μ„±μ΄λ€ λ¬΄μ—‡μΈκ°€μ”?"

# λ΅μ»¬ Ollama λ¨λΈ μ‚¬μ© (Ollama μ„λ²„κ°€ μ‹¤ν–‰ μ¤‘μ΄μ–΄μ•Ό ν•¨)
PYTHONPATH=src poetry run python scripts/run_rag.py "κ΄‘ν•©μ„±μ΄λ€ λ¬΄μ—‡μΈκ°€μ”?" --generator_type ollama

### **2.2. λ€ν μ μ¶ νμΌ μƒμ„±**

evaluate.py μ¤ν¬λ¦½νΈλ” κ³µμ‹ ν‰κ°€ λ°μ΄ν„°(eval.jsonl)λ¥Ό μ‚¬μ©ν•μ—¬ κ° μ§λ¬Έμ— λ€ν• κ²€μƒ‰ κ²°κ³Όλ¥Ό μƒμ„±ν•κ³ , μ΄λ¥Ό λ€ν μ μ¶ ν•μ‹μΈ submission.csv νμΌλ΅ μ €μ¥ν•©λ‹λ‹¤.

PYTHONPATH=src poetry run python scripts/evaluate.py

μ‹¤ν–‰μ΄ μ™„λ£λλ©΄ outputs/ λ””λ ‰ν† λ¦¬μ—μ„ μ μ¶ νμΌμ„ ν™•μΈν•  μ μμµλ‹λ‹¤.

**μƒν” μ μ ν•:** λΉ λ¥Έ ν…μ¤νΈλ¥Ό μ„ν•΄ μƒν” μλ¥Ό μ ν•ν•  μ μμµλ‹λ‹¤. κΈ°λ³Έμ μΌλ΅ μ „μ²΄ ν‰κ°€ λ°μ΄ν„°λ¥Ό μ‚¬μ©ν•μ§€λ§, `params.submission.max_samples` νλΌλ―Έν„°λ΅ μ ν•ν•  μ μμµλ‹λ‹¤ (0μ΄λ©΄ μ „μ²΄ μ‚¬μ©).

# 10κ° μƒν”λ΅ λΉ λ¥Έ μ μ¶ νμΌ μƒμ„±
PYTHONPATH=src poetry run python scripts/evaluate.py params.submission.max_samples=10

## **3. λ¨λΈ μ„±λ¥ νλ‹ λ° κ²€μ¦**

μµμ μ μ„±λ¥μ„ λ‚΄λ” λ¨λΈμ„ μ°ΎκΈ° μ„ν• μ‹¤ν— λ° κ²€μ¦ κ³Όμ •μ…λ‹λ‹¤. μ΄ κ³Όμ •μ€ κ³µμ‹ ν‰κ°€ λ°μ΄ν„°λ¥Ό μ‚¬μ©ν•κΈ° μ „μ— μν–‰ν•μ—¬ κ³Όμ ν•©(overfitting)μ„ λ°©μ§€ν•λ” λ° ν•„μμ μ…λ‹λ‹¤.

### **3.1. κ²€μ¦ λ°μ΄ν„°μ…‹ μƒμ„±**

create_validation_set.py μ¤ν¬λ¦½νΈλ¥Ό μ‚¬μ©ν•μ—¬ μ›λ³Έ λ¬Έμ„μ—μ„ μ§λ¬Έμ„ μλ™μΌλ΅ μƒμ„±, μμ‹ λ§μ κ²€μ¦ λ°μ΄ν„°μ…‹(validation.jsonl)μ„ λ§λ“­λ‹λ‹¤.

**μ™ ν•„μ”ν•κ°€μ”?**

κ³µμ‹ eval.jsonlμ— λ¨λΈμ„ λ°λ³µμ μΌλ΅ ν…μ¤νΈν•λ©΄, μμ‹ λ„ λ¨λ¥΄κ² ν•΄λ‹Ή λ°μ΄ν„°μ…‹μ—λ§ μ λ™μ‘ν•λ” νΈν–¥λ λ¨λΈμ„ λ§λ“¤κ² λ  μ„ν—μ΄ μμµλ‹λ‹¤. λ…λ¦½μ μΈ κ²€μ¦ λ°μ΄ν„°μ…‹μ„ μ‚¬μ©ν•λ©΄ μΌλ°ν™” μ„±λ¥μ„ κ°κ΄€μ μΌλ΅ μΈ΅μ •ν•  μ μμµλ‹λ‹¤.

# 50κ°μ μ§λ¬Έ-λ¬Έμ„ μμΌλ΅ κµ¬μ„±λ κ²€μ¦ λ°μ΄ν„°μ…‹ μƒμ„±
PYTHONPATH=src poetry run python scripts/create_validation_set.py --sample_size 50

data/validation.jsonl νμΌμ΄ μƒμ„±λ©λ‹λ‹¤.

### **3.2. κ²€μƒ‰ μ„±λ¥ κ²€μ¦ λ° ν•μ΄νΌνλΌλ―Έν„° νλ‹**

validate_retrieval.py μ¤ν¬λ¦½νΈλ” validation.jsonl νμΌμ„ μ‚¬μ©ν•μ—¬ ν„μ¬ λ¨λΈμ κ²€μƒ‰ μ„±λ¥μ„ **MAP(Mean Average Precision)** μ μλ΅ μΈ΅μ •ν•©λ‹λ‹¤. μ΄ μ¤ν¬λ¦½νΈλ¥Ό μ‚¬μ©ν•μ—¬ λ‹¤μ–‘ν• ν•μ΄νΌνλΌλ―Έν„°λ¥Ό ν…μ¤νΈν•κ³  μµμ μ μ΅°ν•©μ„ μ°Ύμ„ μ μμµλ‹λ‹¤.

μ‚¬μ© μμ‹: alpha κ°’ νλ‹
alphaλ” BM25(ν‚¤μ›λ“ κ²€μƒ‰)μ™€ μ‹λ§¨ν‹± κ²€μƒ‰(μλ―Έ κΈ°λ° κ²€μƒ‰)μ κ°€μ¤‘μΉλ¥Ό μ΅°μ ν•λ” μ¤‘μ”ν• νλΌλ―Έν„°μ…λ‹λ‹¤.
# κΈ°μ¤€ μ„±λ¥ μΈ΅μ • (alpha κΈ°λ³Έκ°’ μ‚¬μ©)
PYTHONPATH=src poetry run python scripts/validate_retrieval.py

# μ‹λ§¨ν‹± κ²€μƒ‰μ— λ” ν° κ°€μ¤‘μΉλ¥Ό λ¶€μ—¬ν•μ—¬ ν…μ¤νΈ
PYTHONPATH=src poetry run python scripts/validate_retrieval.py --alpha 0.3

# ν‚¤μ›λ“ κ²€μƒ‰μ— λ” ν° κ°€μ¤‘μΉλ¥Ό λ¶€μ—¬ν•μ—¬ ν…μ¤νΈ
PYTHONPATH=src poetry run python scripts/validate_retrieval.py --alpha 0.7

κ°κ°μ MAP μ μλ¥Ό λΉ„κµν•μ—¬ κ°€μ¥ λ†’μ€ μ μλ¥Ό λ‚΄λ” alpha κ°’μ„ μ°Ύμ€ ν›„, κ·Έ κ°’μ„ μµμΆ… λ¨λΈμ— μ μ©ν•  μ μμµλ‹λ‹¤.

## **4. κ³ κΈ‰ μ‹¤ν— κ°€μ΄λ“**

ν”„λ΅μ νΈμ μ„±λ¥μ„ κ·Ήλ€ν™”ν•κΈ° μ„ν• μ¶”κ°€μ μΈ μ‹¤ν— λ°©λ²•μ…λ‹λ‹¤.

### **4.1. μ„λ² λ”© λ¨λΈ λ³€κ²½**

hybrid_retrieveμ μ„±λ¥μ€ μ„λ² λ”© λ¨λΈμ— ν¬κ² μΆμ°λ©λ‹λ‹¤. .env νμΌμ—μ„ EMBEDDING_MODEL κ°’μ„ λ³€κ²½ν•μ—¬ λ‹¤λ¥Έ λ¨λΈμ„ ν…μ¤νΈν•  μ μμµλ‹λ‹¤.

# .env νμΌ μμ‹
# λ‹¤λ¥Έ ν•κµ­μ–΄ νΉν™” λ¨λΈλ΅ λ³€κ²½ν•μ—¬ ν…μ¤νΈ
EMBEDDING_MODEL=Upstage/solar-1-mini-embedding-ko

**μ¤‘μ”:** μ„λ² λ”© λ¨λΈμ„ λ³€κ²½ν• ν›„μ—λ” **λ°λ“μ‹ λ°μ΄ν„°λ¥Ό μ¬μƒ‰μΈ**ν•΄μ•Ό ν•©λ‹λ‹¤. (scripts/reindex.py μ‹¤ν–‰)

### **4.2. ν”„λ΅¬ν”„νΈ μμ •**

LLMμ λ™μ‘(λ„κµ¬ νΈμ¶, λ‹µλ³€ μƒμ„±)μ€ ν”„λ΅¬ν”„νΈμ— λ§¤μ° λ―Όκ°ν•©λ‹λ‹¤. prompts/ λ””λ ‰ν† λ¦¬μ scientific_qa_v1.jinja2 λλ” conversational_v1.jinja2 νμΌμ„ μμ •ν•μ—¬ LLMμ μ‘λ‹µμ„ κ°μ„ ν•  μ μμµλ‹λ‹¤.

* **μ‹¤ν—:** λ„κµ¬ νΈμ¶ μ„¤λ…μ„ λ” λ…ν™•ν•κ² ν•κ±°λ‚, λ‹µλ³€ μ¤νƒ€μΌμ„ λ³€κ²½ν•λ” λ“±μ μμ •μ„ μ‹λ„ν•΄λ³Ό μ μμµλ‹λ‹¤.
* **κ²€μ¦:** ν”„λ΅¬ν”„νΈλ¥Ό μμ •ν• ν›„μ—λ” validate_retrieval.pyλ¥Ό μ‹¤ν–‰ν•μ—¬ MAP μ μκ°€ ν–¥μƒλμ—λ”μ§€ λ°λ“μ‹ ν™•μΈν•΄μ•Ό ν•©λ‹λ‹¤.

---

### **5.1 Streamlit UI μ‹¤ν–‰**
# λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ν•λ©΄ μ›Ή λΈλΌμ°μ €μ—μ„ μλ™μΌλ΅ λ€μ‹λ³΄λ“ νμ΄μ§€κ°€ μ—΄λ¦½λ‹λ‹¤.
```bash
poetry run streamlit run scripts/visualize_results.py
```

### **5.2 νλ‹ μ‹¤ν–‰ λ° μµμ κ°’ μ μ©**

1.  **μ¤ν¬λ¦½νΈ μ‹¤ν–‰ κ¶ν• λ¶€μ—¬:**
ν„°λ―Έλ„μ—μ„ λ‹¤μ λ…λ Ήμ–΄λ¥Ό ν• λ²λ§ μ‹¤ν–‰ν•μ—¬ μ¤ν¬λ¦½νΈλ¥Ό μ‹¤ν–‰ κ°€λ¥ν•κ² λ§λ“μ„Έμ”.
```bash
chmod +x scripts/run_hyperparameter_tuning.sh
```

2.  **ν•μ΄νΌνλΌλ―Έν„° νλ‹ μ‹¤ν–‰:**
ν”„λ΅μ νΈ λ£¨νΈ λ””λ ‰ν† λ¦¬μ—μ„ μ•„λ λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ν•©λ‹λ‹¤.
```bash
./scripts/run_hyperparameter_tuning.sh
```
